const ClassName={BACKDROP:"modal-backdrop",OPEN:"is-open",IN:"in",OUT:"out",DIALOG:"modal-dialog"},KeyCodes={ESC:27,TAB:9},DefaultConfig={transition:!0},throwError=s=>window.console.error(`PureModal: ${s}`),reflow=s=>s.offsetHeight;class PureModal{constructor(s,e){this.id=s,this.config=Object.assign({},DefaultConfig,e),this.modal=PureModal.findModal(this.id),this.dialog=this.modal.querySelector(`.${ClassName.DIALOG}`),this.backdrop=null,this.isOpen=!1,this.isInit=!1,this.triggers=PureModal.findTriggers(this.id),this.closeEls=null,this.focusableEls=null,this.focusedElBeforeOpen=null,this.firstFocusableEl=null,this.lastFocusableEl=null,this.open=this.open.bind(this),this.close=this.close.bind(this),this.onDismiss=this.onDismiss.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}init(){this.isInit?throwError("Event listeners already added."):(this.triggers.forEach(s=>s.addEventListener("click",this.open)),this.isInit=!0)}destroy(){this.isInit?(this.triggers.forEach(s=>s.removeEventListener("click",this.open)),this.isInit=!1):throwError("Event listeners already removed.")}open(s){s.preventDefault(),"function"==typeof this.config.beforeOpen&&this.config.beforeOpen(),this.focusedElBeforeOpen=document.activeElement,this.focusableEls=[...this.dialog.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]')],this.firstFocusableEl=this.focusableEls[0],this.lastFocusableEl=this.focusableEls[this.focusableEls.length-1],this.showBackdrop(),this.modal.style.display="block",this.config.transition?(this.modal.classList.add(ClassName.OPEN),this.modal.classList.add(ClassName.IN),this.openWithTransition()):this.firstFocusableEl.focus(),document.addEventListener("mousedown",this.onDismiss),document.addEventListener("keydown",this.handleKeyDown),this.closeEls=[...this.modal.querySelectorAll('[data-dismiss="modal"]')],this.closeEls.forEach(s=>s.addEventListener("click",this.close)),this.isOpen=!0,"function"==typeof this.config.onOpen&&this.config.onOpen()}openWithTransition(){const s=()=>{this.dialog.removeEventListener("animationend",s),this.firstFocusableEl.focus(),"function"==typeof this.config.onOpen&&this.config.onOpen()};this.dialog.addEventListener("animationend",s)}close(){"function"==typeof this.config.beforeClose&&this.config.beforeClose(),this.config.transition?(this.modal.classList.remove(ClassName.IN),this.modal.classList.remove(ClassName.OPEN),this.modal.classList.add(ClassName.OUT),this.closeWithTransition(),this.closeBackdrop()):(this.modal.style.display="none",this.modal.classList.remove(ClassName.OPEN),this.closeBackdrop(),"function"==typeof this.config.onClose&&this.config.onClose()),document.removeEventListener("mousedown",this.onDismiss),document.removeEventListener("keydown",this.handleKeyDown),this.closeEls.forEach(s=>s.removeEventListener("click",this.close)),this.isOpen=!1,this.focusedElBeforeOpen.focus()}closeWithTransition(){const s=()=>{this.dialog.removeEventListener("animationend",s),this.modal.style.display="none",this.modal.classList.remove(ClassName.OUT),"function"==typeof this.config.onClose&&this.config.onClose()};this.dialog.addEventListener("animationend",s)}onDismiss(s){!this.dialog.contains(s.target)&&this.isOpen&&this.close()}showBackdrop(){this.backdrop=document.createElement("div"),this.backdrop.tabIndex=-1,this.backdrop.classList.add(ClassName.BACKDROP),this.config.transition&&this.backdrop.classList.add(ClassName.IN),document.body.appendChild(this.backdrop),reflow(this.backdrop),this.backdrop.classList.add(ClassName.OPEN)}closeBackdrop(){this.config.transition?(this.backdrop.classList.remove(ClassName.IN),this.backdrop.classList.remove(ClassName.OPEN),this.backdrop.classList.add(ClassName.OUT),this.closeBackdropWithTransition()):this.backdrop.remove()}closeBackdropWithTransition(){const s=()=>{this.backdrop.removeEventListener("transitionend",s),this.backdrop.remove()};this.backdrop.addEventListener("transitionend",s)}handleKeyDown(s){const e=()=>{document.activeElement===this.firstFocusableEl&&(s.preventDefault(),this.lastFocusableEl.focus())},t=()=>{document.activeElement===this.lastFocusableEl&&(s.preventDefault(),this.firstFocusableEl.focus())};switch(s.keyCode){case KeyCodes.TAB:if(1===this.focusableEls.length){s.preventDefault();break}s.shiftKey?e():t();break;case KeyCodes.ESC:this.close()}}static findTriggers(s){return[...document.querySelectorAll(`[data-toggle="modal"][data-target="${s}"]`)]}static findModal(s){return document.getElementById(s)}}"undefined"!=typeof module&&void 0!==module.exports?module.exports=PureModal:window.PureModal=PureModal;